import{r as c,q as S,W as z,j as e,a as H,d as J,y as K}from"./app-DoPl5lFM.js";import{A as Q}from"./AuthenticatedLayout-BAzWT1Pc.js";import{T as x}from"./TextInput-B2uDKCmh.js";import{I as o}from"./InputLabel-C-Tz_r5K.js";import{D as r}from"./Dropdown-C-i2qCtQ.js";import{D as N,a as b}from"./DropDownItem-BiquOykW.js";import{P as C}from"./PrimaryButton-s6j7ElbD.js";import{I as d}from"./InputError-ByfgtF5w.js";import{A as X}from"./AlertMessage-CubBamYp.js";import{C as y}from"./Constants-Cwa85801.js";import{h as T}from"./moment-C5S46NFB.js";import"./SR-BoSPAYsv.js";import"./transition-YMyy0hwJ.js";function oe({auth:D,clients:g,sowings:h}){var w;const A=c.useRef(null),s=S().props.errors,a=S().props,{data:n,setData:l,post:R,patch:F,reset:I,processing:M}=z({sowing_id:null,client_id:null,unit_cost:"",total_weight:"",manual_created_at:T().format(y.DATEFORMAT)}),[L,j]=c.useState(""),[k,p]=c.useState("Seleccionar cliente"),[q,f]=c.useState("Seleccionar cosecha"),[O,m]=c.useState(0);c.useEffect(()=>{var t;(t=a==null?void 0:a.sale)!=null&&t.id&&V(a.sale)},[]);const V=t=>{l({sowing_id:t.sowing_id,client_id:t.client_id,unit_cost:t.unit_cost,total_weight:t.total_weight,manual_created_at:T(t.manual_created_at).format(y.DATEFORMAT)}),m(t.unit_cost*t.total_weight);const i=g.data.find(u=>u.id===t.client_id),v=h.find(u=>u.id===t.sowing_id);p(i?i.name:"Seleccionar cliente"),f(v?v.name:"Seleccionar cosecha")},U=t=>{var i;t.preventDefault(),(i=a==null?void 0:a.sale)!=null&&i.id?F(a.formActionUrl,{onSuccess:()=>_()}):R(a.formActionUrl,{onSuccess:()=>_()})},_=()=>{var i;let t="modificada";(i=a==null?void 0:a.sale)!=null&&i.id||(I(),t="agregada"),j("La venta fue "+t+" satisfactoriamente"),setTimeout(()=>{K.visit(route("sales"))},1500)},B=()=>g.data.map(t=>e.jsx(b,{onClick:()=>W(t),children:t.name},t.id)),G=()=>h.map(t=>e.jsx(b,{onClick:()=>$(t),children:t.name},t.id)),W=t=>{p(t.name),l({...n,client_id:t.id})},$=t=>{f(t.name),l({...n,sowing_id:t.id})};return e.jsxs(Q,{user:D.user,children:[e.jsx(H,{title:"Registrar Venta"}),e.jsx("div",{className:"py-4 lg:py-6 bg-gray-100",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-4 lg:px-4",children:[e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex justify-between items-start flex-wrap gap-4 mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ventas"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Crear una Venta"})]})})}),e.jsx(X,{title:L,onClose:()=>j("")}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg p-5 mb-6",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid md:grid-cols-2 sm:grid-cols-1 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Cosecha"}),e.jsxs(r,{children:[e.jsx(r.Trigger,{children:e.jsx(N,{className:"items-center cursor-pointer",children:q})}),e.jsx(r.Content,{align:"left",className:"px-2",width:100,children:G()})]}),(s==null?void 0:s.sowing_id)&&e.jsx(d,{message:s.sowing_id})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Cliente"}),e.jsxs(r,{children:[e.jsx(r.Trigger,{children:e.jsx(N,{className:"items-center cursor-pointer",children:k})}),e.jsx(r.Content,{align:"left",className:"px-2",width:100,children:B()})]}),(s==null?void 0:s.client_id)&&e.jsx(d,{message:s.client_id})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Fecha de venta"}),e.jsx(x,{type:"date",className:"w-full",name:"manual_created_at",value:n.manual_created_at,required:!0,onChange:t=>l(t.target.name,t.target.value)}),(s==null?void 0:s.manual_created_at)&&e.jsx(d,{message:s.manual_created_at})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Precio unitario"}),e.jsx(x,{type:"number",className:"w-full",name:"unit_cost",value:n.unit_cost,required:!0,onChange:t=>{l(t.target.name,t.target.value),m(parseFloat(t.target.value||0)*parseFloat(n.total_weight||0))}}),(s==null?void 0:s.unit_cost)&&e.jsx(d,{message:s.unit_cost})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Peso total"}),e.jsx(x,{type:"number",className:"w-full",name:"total_weight",value:n.total_weight,onChange:t=>{l(t.target.name,t.target.value),m(parseFloat(n.unit_cost||0)*parseFloat(t.target.value||0))}}),(s==null?void 0:s.total_weight)&&e.jsx(d,{message:s.total_weight})]})]}),e.jsxs("p",{className:"text-right text-lg",children:["La cosecha ",(w=a==null?void 0:a.sale)!=null&&w.id?"fue vendida":"ser√° vendida"," por"," ",e.jsxs("span",{className:"font-bold text-green-700",children:["$",O.toLocaleString("es-CO")]})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-4",children:[e.jsx(J,{href:route("sales"),children:e.jsx(C,{className:"gray bg-gray-800 text-white",children:"Regresar"})}),e.jsx(C,{type:"submit",className:"bg-orange-600 text-white",disabled:M,children:"Guardar"}),e.jsx("button",{type:"reset",className:"hidden",ref:A,children:"reset"})]})]})})]})})})]})}export{oe as default};
